<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emmett's 3D Model Viewer</title>
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/randomcolor/randomColor.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.0/dist/aframe-extras.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: #0F0F0F;
    }
    
    .ui-overlay {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      background: rgba(15, 15, 15, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 15px 25px;
      color: white;
      display: flex;
      align-items: center;
      gap: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    
    .nav-button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 10px;
      padding: 12px 18px;
      color: white;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .nav-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    .nav-button:active {
      transform: translateY(0);
    }
    
    .nav-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: 0 2px 10px rgba(102, 126, 234, 0.2);
    }
    
    .model-info {
      text-align: center;
      flex-grow: 1;
    }
    
    .model-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .model-counter {
      font-size: 12px;
      opacity: 0.7;
      margin: 2px 0 0 0;
    }
    
    .loading-indicator {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2000;
      background: rgba(15, 15, 15, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      color: white;
      text-align: center;
      display: none;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      margin: 0 auto 15px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .home-button {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      border: none;
      border-radius: 50px;
      padding: 15px 20px;
      color: white;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .home-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
    }
  </style>
</head>
<body>
  <div class="ui-overlay">
    <button class="nav-button" id="prevBtn">
      <span>‚Üê</span> Previous
    </button>
    <div class="model-info">
      <h3 class="model-title" id="modelTitle">Loading...</h3>
      <p class="model-counter" id="modelCounter">1 / 6</p>
    </div>
    <button class="nav-button" id="nextBtn">
      Next <span>‚Üí</span>
    </button>
  </div>

  <div class="loading-indicator" id="loadingIndicator">
    <div class="spinner"></div>
    <p>Loading 3D Model...</p>
  </div>

  <a href="index.html" class="home-button">
    <span>üè†</span> Back to Lobby
  </a>

  <a-scene background="color: #0F0F0F" renderer="antialias: true; colorManagement: true; sortObjects: true">
    <a-assets>
      <!-- Assets will be loaded dynamically -->
    </a-assets>

    <!-- Camera with smooth controls -->
    <a-entity id="cameraRig" position="0 2 5">
      <a-entity 
        camera 
        look-controls="pointerLockEnabled: false" 
        wasd-controls="acceleration: 20"
        mouse-cursor="">
      </a-entity>
    </a-entity>
    
    <!-- Model display area -->
    <a-entity id="modelContainer" position="0 0 0"></a-entity>
    
    <!-- Enhanced lighting setup -->
    <a-light 
      type="directional" 
      position="2 4 2" 
      light="castShadow: true; shadowMapWidth: 2048; shadowMapHeight: 2048; intensity: 1.2"
      shadow="type: pcf">
    </a-light>
    <a-light type="ambient" intensity="0.4" color="#404040"></a-light>
    <a-light type="point" position="-2 2 2" intensity="0.8" color="#667eea"></a-light>
    
    <!-- Subtle ground plane for shadows -->
    <a-plane 
      position="0 -1 0" 
      rotation="-90 0 0" 
      width="20" 
      height="20" 
      color="#1a1a1a" 
      shadow="receive: true"
      material="roughness: 0.8">
    </a-plane>
  </a-scene>

  <script>
    const models = [
      {
        id: 'flynnRyan',
        src: 'mdl/flynnryan-showcase-glitch-me.glb',
        title: 'Flynn Ryan Showcase',
        scale: '1 1 1',
        position: '0 0 0'
      },
      {
        id: 'shiftingAtlas',
        src: 'mdl/shiftingatlas-glitch-me.glb',
        title: 'Shifting Atlas',
        scale: '1 1 1',
        position: '0 0 0'
      },
      {
        id: 'johnLoren',
        src: 'mdl/johnloren-gandalf-glitch-me.glb',
        title: 'John Loren - Gandalf',
        scale: '1 1 1',
        position: '0 0 0'
      },
      {
        id: 'briarWolf',
        src: 'mdl/spezsnek-glitch-me.glb',
        title: 'Briar Wolf',
        scale: '1 1 1',
        position: '0 0 0'
      },
      {
        id: 'keroArt',
        src: 'mdl/keroart-flu-glitch-me.glb',
        title: 'Kero Art - Flu',
        scale: '1 1 1',
        position: '0 0 0'
      },
      {
        id: 'walkerT',
        src: 'mdl/walkert-glitch-me.glb',
        title: 'Walker T',
        scale: '1 1 1',
        position: '0 0 0'
      }
    ];

    let currentModelIndex = 0;
    let isLoading = false;
    let currentModelEntity = null;
    let currentAssetItem = null;

    // Get DOM elements
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const modelTitle = document.getElementById('modelTitle');
    const modelCounter = document.getElementById('modelCounter');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const modelContainer = document.getElementById('modelContainer');
    const assets = document.querySelector('a-assets');

    // Wait for A-Frame to be ready
    document.addEventListener('DOMContentLoaded', function() {
      const scene = document.querySelector('a-scene');
      scene.addEventListener('loaded', function() {
        loadModel(currentModelIndex);
      });
    });

    // Navigation event listeners
    prevBtn.addEventListener('click', () => {
      if (!isLoading && currentModelIndex > 0) {
        loadModel(currentModelIndex - 1);
      }
    });

    nextBtn.addEventListener('click', () => {
      if (!isLoading && currentModelIndex < models.length - 1) {
        loadModel(currentModelIndex + 1);
      }
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (isLoading) return;
      
      if (e.key === 'ArrowLeft' && currentModelIndex > 0) {
        loadModel(currentModelIndex - 1);
      } else if (e.key === 'ArrowRight' && currentModelIndex < models.length - 1) {
        loadModel(currentModelIndex + 1);
      }
    });

    function showLoading() {
      isLoading = true;
      loadingIndicator.style.display = 'block';
      updateButtons();
    }

    function hideLoading() {
      isLoading = false;
      loadingIndicator.style.display = 'none';
      updateButtons();
    }

    function updateButtons() {
      prevBtn.disabled = isLoading || currentModelIndex === 0;
      nextBtn.disabled = isLoading || currentModelIndex === models.length - 1;
    }

    function updateUI(index) {
      const model = models[index];
      modelTitle.textContent = model.title;
      modelCounter.textContent = `${index + 1} / ${models.length}`;
      
      // Update info panel
      projectTitle.textContent = model.title;
      projectNotes.textContent = model.notes;
      projectDate.textContent = model.date;
      projectType.textContent = model.type;
      
      // Update tags
      projectTags.innerHTML = '';
      if (model.tags && model.tags.length > 0) {
        model.tags.forEach(tag => {
          const tagElement = document.createElement('span');
          tagElement.className = 'project-tag';
          tagElement.textContent = tag;
          projectTags.appendChild(tagElement);
        });
      }
      
      updateButtons();
    }

    function cleanupCurrentModel() {
      // Remove current model entity
      if (currentModelEntity) {
        modelContainer.removeChild(currentModelEntity);
        currentModelEntity = null;
      }

      // Remove asset from a-assets to free memory
      if (currentAssetItem) {
        assets.removeChild(currentAssetItem);
        currentAssetItem = null;
      }
    }

    function loadModel(index) {
      if (isLoading || index < 0 || index >= models.length) return;

      showLoading();
      const model = models[index];

      // Clean up previous model
      cleanupCurrentModel();

      // Create new asset item
      currentAssetItem = document.createElement('a-asset-item');
      currentAssetItem.setAttribute('id', model.id);
      currentAssetItem.setAttribute('src', model.src);
      assets.appendChild(currentAssetItem);

      // Wait for asset to load
      currentAssetItem.addEventListener('loaded', () => {
        // Create new model entity
        currentModelEntity = document.createElement('a-entity');
        currentModelEntity.setAttribute('gltf-model', `#${model.id}`);
        currentModelEntity.setAttribute('scale', model.scale);
        currentModelEntity.setAttribute('position', model.position);
        currentModelEntity.setAttribute('shadow', 'cast: true; receive: true');
        
        // Add smooth rotation animation
        currentModelEntity.setAttribute('animation', {
          property: 'rotation',
          to: '0 360 0',
          loop: true,
          dur: 20000,
          easing: 'linear'
        });

        // Add hover scaling effect
        currentModelEntity.setAttribute('animation__mouseenter', {
          property: 'scale',
          to: '1.1 1.1 1.1',
          startEvents: 'mouseenter',
          dur: 300
        });
        
        currentModelEntity.setAttribute('animation__mouseleave', {
          property: 'scale',
          to: model.scale,
          startEvents: 'mouseleave',
          dur: 300
        });

        modelContainer.appendChild(currentModelEntity);
        
        currentModelIndex = index;
        updateUI(index);
        hideLoading();
      });

      // Handle loading errors
      currentAssetItem.addEventListener('error', () => {
        console.error(`Failed to load model: ${model.src}`);
        hideLoading();
        // You could show an error message here
      });
    }
  </script>
</body>
</html>